
import React, { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from '@/components/ui/accordion';
import { Avatar, AvatarFallback } from '@/components/ui/avatar';
import { ArrowLeft, Save, Plus, X, HelpCircle, Upload } from 'lucide-react';
import { useToast } from '@/hooks/use-toast';
import { supabase } from '@/integrations/supabase/client';
import ProfileQuestions from './ProfileQuestions';

interface EditableProfileProps {
  onBack: () => void;
  userName: string;
}

interface DetailedProfile {
  name?: string;
  bio?: string;
  location?: string;
  birthday?: string;
  age?: string;
  email?: string;
  phone?: string;
  website?: string;
  instagram?: string;
  twitter?: string;
  linkedin?: string;
  passions: string[];
  hobbies: string[];
  ambitions?: string;
  dreams?: string;
  goals?: string;
  questions: string[];
  interests: string[];
  skills: string[];
  education?: string;
  work?: string;
  relationship_status?: string;
  looking_for?: string;
  profile_photo?: string;
}

const EditableProfile = ({ onBack, userName }: EditableProfileProps) => {
  console.log('EditableProfile component mounted');
  const { toast } = useToast();
  const [showProfileQuestions, setShowProfileQuestions] = useState(false);
  const [profile, setProfile] = useState<DetailedProfile>({
    name: userName,
    passions: [],
    hobbies: [],
    questions: [],
    interests: [],
    skills: []
  });
  const [uploadingPhoto, setUploadingPhoto] = useState(false);
  const [newPassion, setNewPassion] = useState('');
  const [newHobby, setNewHobby] = useState('');
  const [newQuestion, setNewQuestion] = useState('');
  const [newInterest, setNewInterest] = useState('');
  
  const [loading, setLoading] = useState(false);

  // Show ProfileQuestions component if requested
  if (showProfileQuestions) {
    return (
      <ProfileQuestions
        onBack={() => setShowProfileQuestions(false)}
        userName={userName}
      />
    );
  }

  useEffect(() => {
    fetchProfile();
  }, []);

  const fetchProfile = async () => {
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) {
        console.log('No user found when fetching profile');
        return;
      }

      console.log('Fetching profile for user:', user.id);

      // First, get the user's name from user_profiles
      const { data: userProfileData } = await supabase
        .from('user_profiles')
        .select('contact_info')
        .eq('user_id', user.id)
        .single();

      const userNameFromProfile = userProfileData?.contact_info?.name || userName;

      const { data, error } = await supabase
        .from('detailed_profiles')
        .select('*')
        .eq('user_id', user.id)
        .maybeSingle();

      if (error && error.code !== 'PGRST116') {
        console.error('Error fetching profile:', error);
        return;
      }

      console.log('Profile data fetched:', data);

      if (data) {
        const profileData = {
          name: data.name || userNameFromProfile,
          bio: data.bio || '',
          location: data.location || '',
          birthday: data.birthday || '',
          age: data.age || '',
          email: data.email || user.email || '',
          phone: data.phone || '',
          website: data.website || '',
          instagram: data.instagram || '',
          twitter: data.twitter || '',
          linkedin: data.linkedin || '',
          passions: data.passions || [],
          hobbies: data.hobbies || [],
          ambitions: data.ambitions || '',
          dreams: data.dreams || '',
          goals: data.goals || '',
          questions: data.questions || [],
          interests: data.interests || [],
          skills: data.skills || [],
          education: data.education || '',
          work: data.work || '',
          relationship_status: data.relationship_status || '',
          looking_for: data.looking_for || '',
          profile_photo: data.profile_photo || ''
        };
        console.log('Setting profile state:', profileData);
        setProfile(profileData);
      } else {
        console.log('No profile data found, setting default');
        // Set default profile with user's email and name
        setProfile(prev => ({
          ...prev,
          name: userNameFromProfile,
          email: user.email || ''
        }));
      }
    } catch (error) {
      console.error('Error fetching profile:', error);
    }
  };

  const saveProfile = async () => {
    setLoading(true);
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) {
        toast({
          title: "Error",
          description: "You must be logged in to save your profile.",
          variant: "destructive"
        });
        return;
      }

      // Separate name from other profile data
      const { name, ...profileWithoutName } = profile;

      const profileData = {
        user_id: user.id,
        ...profileWithoutName,
        // Handle empty birthday field - set to null if empty
        birthday: profile.birthday && profile.birthday.trim() ? profile.birthday : null,
        updated_at: new Date().toISOString()
      };

      console.log('Attempting to save profile data:', profileData);

      // Save name to user_profiles.contact_info if it has changed
      if (name) {
        const { data: currentUserProfile } = await supabase
          .from('user_profiles')
          .select('contact_info')
          .eq('user_id', user.id)
          .single();

        const currentName = currentUserProfile?.contact_info?.name;

        if (currentName !== name) {
          const updatedContactInfo = {
            ...currentUserProfile?.contact_info,
            name: name
          };

          const { error: nameError } = await supabase
            .from('user_profiles')
            .update({ contact_info: updatedContactInfo })
            .eq('user_id', user.id);

          if (nameError) {
            console.error('Error saving name:', nameError);
            toast({
              title: "Error",
              description: `Failed to save name: ${nameError.message}`,
              variant: "destructive"
            });
            return;
          }
        }
      }

      // Save to detailed_profiles table (without name)
      const { error: detailedError } = await supabase
        .from('detailed_profiles')
        .upsert(profileData, { onConflict: 'user_id' });

      if (detailedError) {
        console.error('Error saving detailed profile:', detailedError);
        console.error('Profile data that failed:', profileData);
        toast({
          title: "Error",
          description: `Failed to save profile: ${detailedError.message}`,
          variant: "destructive"
        });
        return;
      }

      console.log('Profile saved successfully:', profileData);
      toast({
        title: "Profile Updated!",
        description: "Your profile has been saved successfully.",
      });
    } catch (error) {
      console.error('Error saving profile:', error);
      toast({
        title: "Error",
        description: "Failed to save profile. Please try again.",
        variant: "destructive"
      });
    } finally {
      setLoading(false);
    }
  };

  const addItem = (type: 'passions' | 'hobbies' | 'questions' | 'interests' | 'skills', value: string, setter: (value: string) => void) => {
    console.log(`Adding ${type}:`, value, 'Current profile:', profile);
    if (value.trim() && !profile[type].includes(value.trim())) {
      const newProfile = {
        ...profile,
        [type]: [...profile[type], value.trim()]
      };
      console.log(`Updated ${type}:`, newProfile[type]);
      setProfile(newProfile);
      setter('');
    } else {
      console.log(`Not adding ${type} - either empty or already exists`);
    }
  };

  const removeItem = (type: 'passions' | 'hobbies' | 'questions' | 'interests' | 'skills', item: string) => {
    setProfile(prev => ({
      ...prev,
      [type]: prev[type].filter(i => i !== item)
    }));
  };

  const handlePhotoUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {
    const file = event.target.files?.[0];
    if (!file) return;

    // Validate file size (5MB limit)
    if (file.size > 5 * 1024 * 1024) {
      toast({
        title: "File too large",
        description: "Please select an image under 5MB.",
        variant: "destructive"
      });
      return;
    }

    // Validate file type
    if (!file.type.startsWith('image/')) {
      toast({
        title: "Invalid file type",
        description: "Please select an image file (JPG, PNG, etc.).",
        variant: "destructive"
      });
      return;
    }

    try {
      setUploadingPhoto(true);
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) return;

      // Upload to Supabase Storage
      const fileExt = file.name.split('.').pop();
      const fileName = `${user.id}/profile.${fileExt}`;

      const { error: uploadError } = await supabase.storage
        .from('profile-photos')
        .upload(fileName, file, { upsert: true });

      if (uploadError) {
        console.error('Upload error:', uploadError);
        toast({
          title: "Upload failed",
          description: "Failed to upload photo. Please try again.",
          variant: "destructive"
        });
        return;
      }

      // Get public URL
      const { data: { publicUrl } } = supabase.storage
        .from('profile-photos')
        .getPublicUrl(fileName);

      // Update profile state
      setProfile(prev => ({
        ...prev,
        profile_photo: publicUrl
      }));

      toast({
        title: "Photo uploaded!",
        description: "Your profile photo has been updated.",
      });

    } catch (error) {
      console.error('Error uploading photo:', error);
      toast({
        title: "Upload failed",
        description: "Failed to upload photo. Please try again.",
        variant: "destructive"
      });
    } finally {
      setUploadingPhoto(false);
    }
  };

  // Questions moved to dedicated ProfileQuestions.tsx component
        "What’s a personal dream you are currently working toward?",
        "What’s a big life goal you want to achieve in the next 5 years?",
        "If you could start any project tomorrow, what would it be?",
        "What motivates you to pursue your dreams?",
        "Who or what inspires you to take action on your goals?",
        "What’s a childhood dream you still think about?",
        "If you could leave a legacy, what would it be?",
        "What skills or talents do you want to develop in the next year?",
        "Are you more driven by passion, security, impact, or recognition?",
        "What is one risk you’re willing to take for your dreams?",
        "How do you define success in your own terms?",
        "What are the top three things you want in your life?",
        "What kind of lifestyle are you ultimately working toward?",
        "Do your goals focus more on career, creativity, relationships, or experiences?",
        "What problem in the world would you like to help solve?",
        "If you achieved your ultimate dream, what would life look like?",
        "Does shyness often stop you from making friends ?",
        "Would you prefer to pursue dreams alone or with others?",
        "What would you do if you knew you could not fail?",
        "What is one thing holding you back from your next big step?",
      ],
    },
    {
      id: "perfect",
      title: "In a Perfect World (20 Questions)",
      questions: [
        "Describe your perfect day from start to finish.",
        "If money and time weren’t an issue, what would you be doing right now?",
        "Where would you live if you could live anywhere and why?",
        "Who would you spend the most time with in your ideal life?",
        "What role does travel or exploration play in your perfect life?",
        "What daily routine would make you happiest?",
        "If you could design your dream home, what would it include?",
        "How would you spend your free time in this ideal life?",
        "What kind of work or contribution would give you the most satisfaction?",
        "What kind of community or environment would you thrive in?",
        "In your perfect world, how would you like to impact others?",
        "How much time would you spend on creative or personal projects?",
        "Would your ideal life be peaceful, exciting, or a mix of both?",
        "How much would you want technology to be part of your ideal life?",
        "Would you prefer living in a bustling city, small town, or nature?",
        "What kind of people would you surround yourself with?",
        "If you could change one thing about the world right now, what would it be?",
        "What personal freedoms matter most to you in a perfect world?",
        "What role would friends and community play in your day-to-day life?",
        "What’s one thing your perfect world has that your current life doesn’t?",
      ],
    },
    {
      id: "connection",
      title: "Connection for You (20 Questions)",
      questions: [
        "When do you feel most connected to people?",
        "What makes you feel truly understood by someone?",
        "How often do you want to meet or interact with new friends?",
        "What is one trait that instantly makes you feel closer to someone?",
        "How do you usually break the ice with new people?",
        "Do you feel more comfortable in small gatherings or large social events?",
        "My favorite way to connect is through:",
        "What is something that is a big red flag in a friendship for you?",
        "How do you like friends to show appreciation for you?",
        "What type of messages or conversations make you feel bonded to someone?",
        "How much do shared experiences matter in building your connections?",
        "Do you tend to open up quickly or slowly in new friendships?",
        "Your friendship “green flag”?",
        "What makes a conversation feel meaningful to you?",
        "Do you prefer connecting through activities, conversations, or shared goals?",
        "What do you think is the secret to a lasting friendship?",
        "When you meet someone new, how fast do you usually open up?",
        "What role does humor play in your connections?",
        "How important is it that friends share your communication style?",
        "Which trait instantly makes you feel closer to someone?",
      ],
    },
    {
      id: "personal",
      title: "Personal Questions (20 Questions)",
      questions: [
        "What’s a passion or hobby you could talk about for hours?",
        "Which experiences in life have shaped you the most?",
        "If someone described you in three words, what would they be?",
        "What’s a small joy that makes your life feel meaningful?",
        "Are you more introverted, extroverted, or somewhere in between?",
        "What kind of challenges do you enjoy tackling?",
        "What habits or routines are most important to you?",
        "What are three values you live your life by?",
        "What’s a quirky fact about you that surprises people?",
        "Which fictional character do you relate to most and why?",
        "I feel happiest when I’m…",
        "What kind of art, music, or media moves you deeply?",
        "What’s your love language in friendships? (e.g., words, time, acts of service)",
        "How often do you want to meet new friends or groups?",
        "Do you see yourself as more logical, creative, or balanced?",
        "What is a fear you’ve overcome that shaped you?",
        "Be honest…. Give us up to 3 red flags about you?",
        "What kind of environments bring out your best self?",
        "Who has influenced your life perspective the most?",
        "What’s one thing people often misunderstand about you?",
      ],
    },
  return (
    <div className="min-h-screen bg-gray-50">
      <nav className="bg-white/80 backdrop-blur-sm border-b border-gray-200 p-6">
        <div className="max-w-4xl mx-auto flex items-center justify-between">
          <Button
            onClick={onBack}
            variant="ghost"
            className="flex items-center space-x-2"
          >
            <ArrowLeft className="h-4 w-4" />
            <span>Back to Common Room</span>
          </Button>
          <h1 className="text-xl font-medium text-gray-900">Edit Profile</h1>
          <div className="flex items-center space-x-3">

            <Button
              onClick={saveProfile}
              disabled={loading}
              className="flex items-center space-x-2"
            >
              <Save className="h-4 w-4" />
              <span>{loading ? 'Saving...' : 'Save Profile'}</span>
            </Button>
          </div>
        </div>
      </nav>

      <div className="max-w-4xl mx-auto p-6">
        <div className="space-y-8">
          {/* Profile Header */}
          <Card>
            <CardContent className="p-8">
              <div className="flex items-center space-x-6">
                <Avatar className="h-24 w-24">
                  <AvatarFallback className="bg-gray-100 text-gray-600 text-2xl">
                    {(profile.name || userName).charAt(0)}
                  </AvatarFallback>
                </Avatar>
                <div className="flex-1">
                  <h2 className="text-2xl font-medium text-gray-900 mb-2">{profile.name || userName}</h2>
                  <p className="text-gray-600">Complete your profile to connect better with others</p>
                </div>
              </div>
            </CardContent>
          </Card>

          {/* Basic Information Section - Separate from Deeper Information */}
          <Card className="mb-8">
            <CardHeader>
              <CardTitle className="text-xl">Basic Information</CardTitle>
              <p className="text-sm text-gray-600">Essential details about you</p>
            </CardHeader>
            <CardContent>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Name</label>
                  <Input
                    value={profile.name || ''}
                    onChange={(e) => setProfile(prev => ({ ...prev, name: e.target.value }))}
                    placeholder="Your full name"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Email</label>
                  <Input
                    value={profile.email || ''}
                    onChange={(e) => setProfile(prev => ({ ...prev, email: e.target.value }))}
                    placeholder="your.email@example.com"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Phone</label>
                  <Input
                    value={profile.phone || ''}
                    onChange={(e) => setProfile(prev => ({ ...prev, phone: e.target.value }))}
                    placeholder="+1 (555) 123-4567"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Location</label>
                  <Input
                    value={profile.location || ''}
                    onChange={(e) => setProfile(prev => ({ ...prev, location: e.target.value }))}
                    placeholder="City, State"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Birthday</label>
                  <Input
                    type="date"
                    value={profile.birthday || ''}
                    onChange={(e) => setProfile(prev => ({ ...prev, birthday: e.target.value }))}
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Age</label>
                  <Input
                    type="number"
                    value={profile.age || ''}
                    onChange={(e) => setProfile(prev => ({ ...prev, age: e.target.value }))}
                    placeholder="Your age"
                    min="18"
                    max="100"
                  />
                </div>
              </div>
              <div className="mt-6">
                <label className="block text-sm font-medium text-gray-700 mb-2">Bio</label>
                <Textarea
                  value={profile.bio || ''}
                  onChange={(e) => setProfile(prev => ({ ...prev, bio: e.target.value }))}
                  placeholder="Tell us about yourself..."
                  rows={3}
                />
              </div>
            </CardContent>
          </Card>

          {/* Profile Photo Section */}
          <Card className="mb-8">
            <CardHeader>
              <CardTitle className="text-xl">Profile Photo</CardTitle>
              <p className="text-sm text-gray-600">Add a photo to help others recognize you</p>
            </CardHeader>
            <CardContent>
              <div className="flex items-center space-x-6">
                <div className="relative">
                  <Avatar className="h-24 w-24">
                    {profile.profile_photo ? (
                      <img src={profile.profile_photo} alt="Profile" className="h-full w-full object-cover" />
                    ) : (
                      <AvatarFallback className="bg-gray-100 text-gray-600 text-2xl">
                        {(profile.name || userName).charAt(0)}
                      </AvatarFallback>
                    )}
                  </Avatar>
                </div>
                <div className="flex-1">
                  <Button
                    onClick={() => document.getElementById('profile-photo-input')?.click()}
                    variant="outline"
                    className="mb-2"
                  >
                    <Upload className="h-4 w-4 mr-2" />
                    Upload Photo
                  </Button>
                  <input
                    id="profile-photo-input"
                    type="file"
                    accept="image/*"
                    className="hidden"
                    onChange={handlePhotoUpload}
                  />
                  <p className="text-sm text-gray-500">
                    Upload a clear photo of yourself. JPG, PNG up to 5MB.
                  </p>
                </div>
              </div>
            </CardContent>
          </Card>

          {/* Social Links Section */}
          <Card className="mb-8">
            <CardHeader>
              <CardTitle className="text-xl">Social Links</CardTitle>
              <p className="text-sm text-gray-600">Connect your social profiles</p>
            </CardHeader>
            <CardContent>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Website</label>
                  <Input
                    value={profile.website || ''}
                    onChange={(e) => setProfile(prev => ({ ...prev, website: e.target.value }))}
                    placeholder="https://yourwebsite.com"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Instagram</label>
                  <Input
                    value={profile.instagram || ''}
                    onChange={(e) => setProfile(prev => ({ ...prev, instagram: e.target.value }))}
                    placeholder="@yourusername"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Twitter</label>
                  <Input
                    value={profile.twitter || ''}
                    onChange={(e) => setProfile(prev => ({ ...prev, twitter: e.target.value }))}
                    placeholder="@yourusername"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">LinkedIn</label>
                  <Input
                    value={profile.linkedin || ''}
                    onChange={(e) => setProfile(prev => ({ ...prev, linkedin: e.target.value }))}
                    placeholder="linkedin.com/in/yourprofile"
                  />
                </div>
              </div>
            </CardContent>
          </Card>

          {/* Deeper Information Section - Separated as requested */}
          <div className="border-t-4 border-gray-200 pt-8">
            <h2 className="text-2xl font-bold text-gray-900 mb-2">Deeper Information</h2>
            <p className="text-gray-600 mb-8">Share more about your interests, passions, and what makes you unique</p>

          {/* Second Row - Interests and Skills */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            {/* Interests */}
            <Card>
              <CardHeader>
                <CardTitle>Interests</CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                <div className="flex space-x-2">
                  <Input
                    value={newInterest}
                    onChange={(e) => setNewInterest(e.target.value)}
                    placeholder="Add an interest..."
                    onKeyPress={(e) => e.key === 'Enter' && addItem('interests', newInterest, setNewInterest)}
                  />
                  <Button onClick={() => addItem('interests', newInterest, setNewInterest)} size="sm">
                    <Plus className="h-4 w-4" />
                  </Button>
                </div>
                <div className="flex flex-wrap gap-2">
                  {profile.interests.map((interest, index) => (
                    <span
                      key={index}
                      className="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm flex items-center space-x-2"
                    >
                      <span>{interest}</span>
                      <X
                        className="h-3 w-3 cursor-pointer hover:text-gray-900"
                        onClick={() => removeItem('interests', interest)}
                      />
                    </span>
                  ))}
                </div>
              </CardContent>
            </Card>

            {/* Skills */}
            <Card>
              <CardHeader>
                <CardTitle>Skills</CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                <div className="flex space-x-2">
                  <Input
                    value={profile.skills.join(', ')}
                    onChange={(e) => setProfile(prev => ({ ...prev, skills: e.target.value.split(', ').filter(s => s.trim()) }))}
                    placeholder="Add skills (comma separated)"
                  />
                </div>
                <div className="flex flex-wrap gap-2">
                  {profile.skills.map((skill, index) => (
                    <span
                      key={index}
                      className="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm flex items-center space-x-2"
                    >
                      <span>{skill}</span>
                      <X
                        className="h-3 w-3 cursor-pointer hover:text-blue-900"
                        onClick={() => removeItem('skills', skill)}
                      />
                    </span>
                  ))}
                </div>
              </CardContent>
            </Card>
          </div>

          {/* Third Row - Passions and Hobbies */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            {/* Passions */}
            <Card>
              <CardHeader>
                <CardTitle>Passions</CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                <div className="flex space-x-2">
                  <Input
                    value={newPassion}
                    onChange={(e) => setNewPassion(e.target.value)}
                    placeholder="What are you passionate about?"
                    onKeyPress={(e) => e.key === 'Enter' && addItem('passions', newPassion, setNewPassion)}
                  />
                  <Button onClick={() => addItem('passions', newPassion, setNewPassion)} size="sm">
                    <Plus className="h-4 w-4" />
                  </Button>
                </div>
                <div className="flex flex-wrap gap-2">
                  {profile.passions.map((passion, index) => (
                    <span
                      key={index}
                      className="px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm flex items-center space-x-2"
                    >
                      <span>{passion}</span>
                      <X
                        className="h-3 w-3 cursor-pointer hover:text-red-900"
                        onClick={() => removeItem('passions', passion)}
                      />
                    </span>
                  ))}
                </div>
              </CardContent>
            </Card>

            {/* Hobbies */}
            <Card>
              <CardHeader>
                <CardTitle>Hobbies</CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                <div className="flex space-x-2">
                  <Input
                    value={newHobby}
                    onChange={(e) => setNewHobby(e.target.value)}
                    placeholder="What do you like to do in your free time?"
                    onKeyPress={(e) => e.key === 'Enter' && addItem('hobbies', newHobby, setNewHobby)}
                  />
                  <Button onClick={() => addItem('hobbies', newHobby, setNewHobby)} size="sm">
                    <Plus className="h-4 w-4" />
                  </Button>
                </div>
                <div className="flex flex-wrap gap-2">
                  {profile.hobbies.map((hobby, index) => (
                    <span
                      key={index}
                      className="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm flex items-center space-x-2"
                    >
                      <span>{hobby}</span>
                      <X
                        className="h-3 w-3 cursor-pointer hover:text-green-900"
                        onClick={() => removeItem('hobbies', hobby)}
                      />
                    </span>
                  ))}
                </div>
              </CardContent>
            </Card>
          </div>

          {/* Life Aspirations */}
          <Card>
            <CardHeader>
              <CardTitle>Life Aspirations</CardTitle>
            </CardHeader>
            <CardContent className="space-y-6">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Ambitions</label>
                <Textarea
                  value={profile.ambitions || ''}
                  onChange={(e) => setProfile(prev => ({ ...prev, ambitions: e.target.value }))}
                  placeholder="What are your professional and personal ambitions?"
                  rows={3}
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Dreams</label>
                <Textarea
                  value={profile.dreams || ''}
                  onChange={(e) => setProfile(prev => ({ ...prev, dreams: e.target.value }))}
                  placeholder="What are your biggest dreams?"
                  rows={3}
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Goals</label>
                <Textarea
                  value={profile.goals || ''}
                  onChange={(e) => setProfile(prev => ({ ...prev, goals: e.target.value }))}
                  placeholder="What goals are you working towards?"
                  rows={3}
                />
              </div>
            </CardContent>
          </Card>

          {/* Questions moved to dedicated ProfileQuestions.tsx component */}

          {/* Questions for Others */}
          <Card>
            <CardHeader>
              <CardTitle>Questions for Others</CardTitle>
            </CardHeader>
            <CardContent className="space-y-4">
              <div className="flex space-x-2">
                <Input
                  value={newQuestion}
                  onChange={(e) => setNewQuestion(e.target.value)}
                  placeholder="What would you like to ask potential housemates?"
                  onKeyPress={(e) => e.key === 'Enter' && addItem('questions', newQuestion, setNewQuestion)}
                />
                <Button onClick={() => addItem('questions', newQuestion, setNewQuestion)} size="sm">
                  <Plus className="h-4 w-4" />
                </Button>
              </div>
              <div className="flex flex-wrap gap-2">
                {profile.questions.map((question, index) => (
                  <span
                    key={index}
                    className="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm flex items-center space-x-2"
                  >
                    <span>{question}</span>
                    <X
                      className="h-3 w-3 cursor-pointer hover:text-yellow-600"
                      onClick={() => removeItem('questions', question)}
                    />
                  </span>
                ))}
              </div>
            </CardContent>
          </Card>
          </div> {/* End of Deeper Information Section */}
        </div>
      </div>
    </div>
  );
};

export default EditableProfile;
